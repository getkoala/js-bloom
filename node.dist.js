var c=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var g=t=>c(t,"__esModule",{value:!0});var M=(t,e)=>{for(var s in e)c(t,s,{get:e[s],enumerable:!0})},T=(t,e,s,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of E(e))!A.call(t,i)&&(s||i!=="default")&&c(t,i,{get:()=>e[i],enumerable:!(n=y(e,i))||n.enumerable});return t};var x=(t=>(e,s)=>t&&t.get(e)||(s=T(g({}),e,1),t&&t.set(e,s),s))(typeof WeakMap!="undefined"?new WeakMap:0);var v={};M(v,{CountMinSketch:()=>d,JsBloom:()=>f});function o(t,e=null){if(!t)throw new Error("Missing argument: size");this.ELEMENT_WIDTH=32,this.size=t,this.field=e||[];let s=Math.floor((t-1)/this.ELEMENT_WIDTH+1);if(!e)for(let n=0,i=s-1,r=0<=i;r?n<=i:n>=i;r?n++:n--)this.field[n]=0;return this}o.prototype.add=function(t){return this.set(t,1)};o.prototype.remove=function(t){return this.set(t,0)};o.prototype.set=function(t,e){if(t>=this.size)throw new Error("BitArray index out of bounds");let s=l(t,this.ELEMENT_WIDTH),n=m(t,this.ELEMENT_WIDTH);return e===1?this.field[s]=a(this.field[s]|n):(this.field[s]&n)!==0&&(this.field[s]=a(this.field[s]^n)),!0};o.prototype.get=function(t){if(t>=this.size)throw new Error("BitArray index out of bounds");let e=l(t,this.ELEMENT_WIDTH),s=m(t,this.ELEMENT_WIDTH);return a(this.field[e]&s)>0?1:0};function l(t,e){return Math.floor(t/e)}function m(t,e){return a(1<<t%e)}function a(t){return t<0&&(t+=4294967295),t}function C(){let t,e=[];for(var s=0;s<256;s++){t=s;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;e[s]=t}return e}var w=C(),u=t=>{let e=N(t),s=0,n=0;s=s^-1;let i=0,r=e.length;for(;i<r;)n=(s^e[i])&255,s=s>>>8^w[n],i++;return s=s^-1,s<0&&(s+=4294967296),s},N=t=>{let e=[],s=0;for(;s<t.length;)e.push(t.charCodeAt(s)),++s;return e};var f=function(t={}){this.options={size:100,hashes:4,seed:new Date().getTime()/1e3,bits:null};for(let e in t){let s=t[e];this.options[e]=s}return this.bits=new o(this.options.size,this.options.bits),this},h=f.prototype;h.add=function(...t){for(let e of t)for(let s of Array.from(this.indexesFor(e)))this.bits.add(s)};h.test=function(...t){for(let e of t)for(let s of this.indexesFor(e))if(this.bits.get(s)===0)return!1;return!0};h.toHash=function(){let t={};for(let e in this.options){let s=this.options[e];t[e]=s}return t.bits=this.bits.field,t};h.toJson=function(){return JSON.stringify(this.toHash())};h.indexesFor=function(t){let e=[];for(let s=0,n=this.options.hashes-1,i=0<=n;i?s<=n:s>=n;i?s++:s--)e.push(u(`${t}:${s+this.options.seed}`)%this.options.size);return e};var k=Number.MAX_SAFE_INTEGER-1;function S(t,e){let s=new Array(t);for(let n=0;n<t;n++)s[n]=new Uint32Array(e);return s}function D(t){return t.map(e=>Uint32Array.from(e))}function H(t){return t.map(e=>Array.from(e))}function O(t){let e=new Array(t);for(let s=0;s<t;s++)e[s]=Math.random()*(k+1);return e}var _={size:100,hashes:4},d=class{constructor(e={}){this.options=Object.assign({},_,e),this.k=this.options.hashes,this.m=this.options.size,this.data=this.options.data?D(this.options.data):S(this.k,this.m),this.seeds=this.options.seeds||O(this.k)}count(e){return this.add(e,0)}add(e,s=1){let n=1/0;return this.seeds.forEach((i,r)=>{let b=u(`${e}:${i+r}`)%this.m,p=this.data[r][b]+=s;p<n&&(n=p)}),n}setCount(e,s){this.add(e,s-this.count(e))}toHash(){return Object.assign({},this.options,{data:H(this.data),seeds:this.seeds})}toJSON(){return JSON.stringify(this.toHash())}};module.exports=x(v);
