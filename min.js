function o(t,s=null){if(!t)throw new Error("Missing argument: size");this.ELEMENT_WIDTH=32,this.size=t,this.field=s||[];let e=Math.floor((t-1)/this.ELEMENT_WIDTH+1);if(!s)for(let n=0,i=e-1,r=0<=i;r?n<=i:n>=i;r?n++:n--)this.field[n]=0;return this}o.prototype.add=function(t){return this.set(t,1)};o.prototype.remove=function(t){return this.set(t,0)};o.prototype.set=function(t,s){if(t>=this.size)throw new Error("BitArray index out of bounds");let e=f(t,this.ELEMENT_WIDTH),n=d(t,this.ELEMENT_WIDTH);return s===1?this.field[e]=a(this.field[e]|n):(this.field[e]&n)!==0&&(this.field[e]=a(this.field[e]^n)),!0};o.prototype.get=function(t){if(t>=this.size)throw new Error("BitArray index out of bounds");let s=f(t,this.ELEMENT_WIDTH),e=d(t,this.ELEMENT_WIDTH);return a(this.field[s]&e)>0?1:0};function f(t,s){return Math.floor(t/s)}function d(t,s){return a(1<<t%s)}function a(t){return t<0&&(t+=4294967295),t}function b(){let t,s=[];for(var e=0;e<256;e++){t=e;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;s[e]=t}return s}var y=b(),u=t=>{let s=E(t),e=0,n=0;e=e^-1;let i=0,r=s.length;for(;i<r;)n=(e^s[i])&255,e=e>>>8^y[n],i++;return e=e^-1,e<0&&(e+=4294967296),e},E=t=>{let s=[],e=0;for(;e<t.length;)s.push(t.charCodeAt(e)),++e;return s};var p=function(t={}){this.options={size:100,hashes:4,seed:new Date().getTime()/1e3,bits:null};for(let s in t){let e=t[s];this.options[s]=e}return this.bits=new o(this.options.size,this.options.bits),this},h=p.prototype;h.add=function(...t){for(let s of t)for(let e of Array.from(this.indexesFor(s)))this.bits.add(e)};h.test=function(...t){for(let s of t)for(let e of this.indexesFor(s))if(this.bits.get(e)===0)return!1;return!0};h.toHash=function(){let t={};for(let s in this.options){let e=this.options[s];t[s]=e}return t.bits=this.bits.field,t};h.toJson=function(){return JSON.stringify(this.toHash())};h.indexesFor=function(t){let s=[];for(let e=0,n=this.options.hashes-1,i=0<=n;i?e<=n:e>=n;i?e++:e--)s.push(u(`${t}:${e+this.options.seed}`)%this.options.size);return s};var A=Number.MAX_SAFE_INTEGER-1;function g(t,s){let e=new Array(t);for(let n=0;n<t;n++)e[n]=new Uint32Array(s);return e}function M(t){return t.map(s=>Uint32Array.from(s))}function T(t){return t.map(s=>Array.from(s))}function x(t){let s=new Array(t);for(let e=0;e<t;e++)s[e]=Math.random()*(A+1);return s}var w={size:100,hashes:4},l=class{constructor(s={}){this.options=Object.assign({},w,s),this.k=this.options.hashes,this.m=this.options.size,this.data=this.options.data?M(this.options.data):g(this.k,this.m),this.seeds=this.options.seeds||x(this.k)}count(s){return this.add(s,0)}add(s,e=1){let n=1/0;return this.seeds.forEach((i,r)=>{let m=u(`${s}:${i+r}`)%this.m,c=this.data[r][m]+=e;c<n&&(n=c)}),n}toHash(){return Object.assign({},this.options,{data:T(this.data),seeds:this.seeds})}toJSON(){return JSON.stringify(this.toHash())}};export{l as CountMinSketch,p as JsBloom};
